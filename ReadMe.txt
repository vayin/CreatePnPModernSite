Disclaimer: 

Please note that this code is provided as is. No warranties or support is provided. Always run first in our Dev Tenant to validate the results and proceed to production.

Note:  
You need to install latest PNP powershell commandlets inorder to work. for installing the powershell pnp commands please refer to the below URL
https://docs.microsoft.com/en-us/powershell/sharepoint/sharepoint-pnp/sharepoint-pnp-cmdlets?view=sharepoint-ps